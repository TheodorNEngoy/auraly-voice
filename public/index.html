<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Auraly — Record</title>
  <link rel="stylesheet" href="/styles.css"/>
  <!-- Explicit rendering per docs: use defer (not async), and do NOT call turnstile.ready() -->
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js?render=explicit" defer></script>
  <script src="/auth.js" defer></script>
</head>
<body>
  <header class="top">
    <h1>🎙️ Auraly</h1>
    <nav>
      <a href="/index.html">Record</a>
      <a href="/feed.html">Feed</a>
    </nav>
  </header>

  <main>
    <section class="card">
      <h2>Record a new voice post</h2>

      <!-- The widget must be inside the form so Turnstile auto-injects the hidden cf-turnstile-response field -->
      <form id="uploadForm">
        <div class="row">
          <label>Title</label>
          <input id="title" name="title" placeholder="Optional title…"/>
        </div>

        <div class="row">
          <button type="button" id="startBtn">Start</button>
          <button type="button" id="stopBtn" disabled>Stop</button>
          <button type="submit" id="uploadBtn" disabled>Upload</button>
        </div>

        <div class="row">
          <div id="turnstile-container"></div>
        </div>
      </form>

      <p id="status"></p>
      <audio id="preview" controls></audio>
    </section>

    <section class="card">
      <h2>How it works</h2>
      <ol>
        <li>Record with <code>MediaRecorder</code> (HTTPS required).</li>
        <li>Upload via Pages Function to R2.</li>
        <li>Play back from <code>/api/media/&lt;key&gt;</code>.</li>
      </ol>
    </section>
  </main>

  <script src="/recorder.js"></script>
</body>
</html>

